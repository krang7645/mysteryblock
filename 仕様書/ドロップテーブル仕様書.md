# ドロップテーブル仕様書

## 1. 概要
ミステリーブロックMODのドロップテーブルシステムは、OneBlockデータパックを参考に、より拡張性と柔軟性を持たせた設計とします。

## 2. ドロップテーブルの基本構造

### 2.1 ファイル形式
- JSON形式で定義
- フェーズごとに個別のファイルで管理
- モジュール化された構造で再利用性を確保

### 2.2 基本構造
```json
{
  "phase": {
    "id": "整数値",
    "name": "フェーズ名",
    "description": "説明文",
    "required_breaks": "次のフェーズに進むために必要な破壊回数",
    "drops": [
      {
        "item": "アイテムID",
        "weight": "重み（出現確率）",
        "count": {
          "min": "最小数",
          "max": "最大数"
        },
        "conditions": [
          "出現条件"
        ]
      }
    ]
  }
}
```

## 3. フェーズごとのドロップ設定

### 3.1 フェーズ0（チュートリアル）
- 基本ブロック（確率70%）
  - 土
  - 石
  - 原木
- 基本アイテム（確率25%）
  - 種
  - 苗木
- レアアイテム（確率5%）
  - 鉄インゴット
  - 骨粉

### 3.2 フェーズ1（基本資源）
- 一般鉱石（確率50%）
  - 石炭鉱石
  - 鉄鉱石
  - 金鉱石
- 建材（確率30%）
  - 丸石
  - 木材
  - ガラス
- MOB出現（確率20%）
  - 一般的な動物
  - 基本的なモンスター

## 4. 特殊ドロップ設定

### 4.1 条件付きドロップ
```json
{
  "conditions": {
    "time_of_day": "時間帯",
    "weather": "天候",
    "player_status": "プレイヤーの状態",
    "phase_progress": "フェーズ内の進行度"
  }
}
```

### 4.2 組み合わせドロップ
```json
{
  "combination": {
    "items": [
      "メインアイテム",
      "サブアイテム1",
      "サブアイテム2"
    ],
    "weight": "出現確率"
  }
}
```

## 5. MOB出現設定

### 5.1 基本構造
```json
{
  "mob": {
    "type": "MOBタイプ",
    "nbt": "NBTデータ",
    "equipment": [
      "装備アイテム"
    ],
    "attributes": {
      "health": "体力",
      "damage": "攻撃力"
    }
  }
}
```

### 5.2 特殊MOB設定
- カスタム装備
- 特殊能力
- ドロップアイテムの変更

## 6. 報酬システム

### 6.1 マイルストーン報酬
```json
{
  "milestone": {
    "breaks": "破壊回数",
    "rewards": [
      "特別アイテム"
    ],
    "effects": [
      "特殊効果"
    ]
  }
}
```

### 6.2 実績報酬
- フェーズ固有の実績
- 特別なアイテムや効果
- 進行度に応じた報酬

## 7. バランス調整

### 7.1 重み付けシステム
- 基本アイテム：70-80%
- レアアイテム：15-25%
- 超レアアイテム：1-5%

### 7.2 進行度による調整
- フェーズ進行に応じた確率変動
- プレイヤーの状態による補正
- サーバー負荷による自動調整

## 8. 拡張性

### 8.1 カスタムドロップ
```json
{
  "custom_drop": {
    "type": "カスタムタイプ",
    "data": "カスタムデータ",
    "script": "実行スクリプト"
  }
}
```

### 8.2 MOD連携
- 他MODのアイテム対応
- APIを通じた動的な追加
- イベントフックによる拡張

## 9. パフォーマンス最適化

### 9.1 キャッシュシステム
- 頻出アイテムのキャッシュ
- ドロップテーブルの事前計算
- 動的な負荷分散

### 9.2 非同期処理
- ドロップ生成の非同期化
- バッチ処理による最適化
- メモリ使用量の制御

## 10. デバッグとテスト

### 10.1 検証項目
- ドロップ率の正確性
- バランス調整の効果
- パフォーマンスへの影響

### 10.2 モニタリング
- ドロップ統計の収集
- プレイヤーフィードバック
- サーバー負荷の監視